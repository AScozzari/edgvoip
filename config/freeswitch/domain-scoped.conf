<!-- W3 VoIP System - Domain-scoped Multi-tenant Configuration -->
<!-- FreeSWITCH Configuration for Multi-tenant Support -->

<!-- Domain Configuration -->
<configuration name="domain.conf" description="Multi-tenant Domain Configuration">
  <domains>
    <!-- Default domain for system administration -->
    <domain name="$${domain}" alias="true" parse="true"/>
    
    <!-- Dynamic domain loading from database -->
    <X-PRE-PROCESS cmd="include" data="domain/*.xml"/>
  </domains>
</configuration>

<!-- Directory Configuration for Multi-tenant Users -->
<configuration name="directory.conf" description="Multi-tenant User Directory">
  <profiles>
    <profile name="default">
      <settings>
        <param name="dial-string" value="{presence_id=${dialed_user}@${dialed_domain}}${sofia_contact(${dialed_user}@${dialed_domain})}"/>
        <param name="xml-lookup" value="internal"/>
        <param name="json-lookup" value="internal"/>
      </settings>
      
      <!-- Multi-tenant user groups -->
      <groups>
        <group name="default">
          <users>
            <!-- Dynamic user loading from database -->
            <X-PRE-PROCESS cmd="include" data="directory/default/*.xml"/>
          </users>
        </group>
      </groups>
    </profile>
  </profiles>
</configuration>

<!-- Dialplan Configuration for Multi-tenant Routing -->
<configuration name="dialplan.conf" description="Multi-tenant Dialplan">
  <contexts>
    <context name="default">
      <!-- Tenant-specific dialplan includes -->
      <X-PRE-PROCESS cmd="include" data="dialplan/default/*.xml"/>
    </context>
    
    <context name="internal">
      <!-- Internal tenant routing -->
      <X-PRE-PROCESS cmd="include" data="dialplan/internal/*.xml"/>
    </context>
    
    <context name="public">
      <!-- Public/PSTN routing -->
      <X-PRE-PROCESS cmd="include" data="dialplan/public/*.xml"/>
    </context>
  </contexts>
</configuration>

<!-- ACL Configuration for Tenant Isolation -->
<configuration name="acl.conf" description="Multi-tenant ACL Configuration">
  <network-lists>
    <!-- Default ACL for system -->
    <list name="default" default="deny">
      <node type="allow" cidr="127.0.0.1/32"/>
      <node type="allow" cidr="10.0.0.0/8"/>
      <node type="allow" cidr="172.16.0.0/12"/>
      <node type="allow" cidr="192.168.0.0/16"/>
    </list>
    
    <!-- Dynamic tenant ACLs -->
    <X-PRE-PROCESS cmd="include" data="acl/*.xml"/>
  </network-lists>
</configuration>

